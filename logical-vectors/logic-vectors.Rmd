---
title: "Logical Vectors and `filter()`"
output: 
    learnr::tutorial:
        theme: "sandstone" 
runtime: shiny_prerendered
bibliography: references.bib
---

```{r setup, include=FALSE}
library(learnr)
library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
knitr::opts_chunk$set(echo = FALSE)

quiz_numbers<-c(1, 12, 4, 3, 15)
logic1<-quiz_numbers < 10
df_numbers<-data.frame(Question = sprintf("True or False: the number  ***%s***  is less than 10.",quiz_numbers),
                       AnswerKey = quiz_numbers<10)
set.seed(123)
quiz_numbers2n<-sample(1:30,6)
# logic2<-quiz_numbers < 10
df_numbers2<-data.frame(Question = sprintf("True or False: the number  ***%s***  is greater than 15.",quiz_numbers2n))
set.seed(321)
students<-data.frame(height = round(rnorm(150, 68, 5),1),
                    IQ = round(rnorm(150, 100,8),0))

small_iris<-iris %>% select(Species,Sepal.Length) %>%
    slice(1:3, 51:53, 101:103)
tweets<-read.csv('data/twcs_small.csv',header = T)
tweets<- tweets %>% 
    select(author_id, inbound, text)
```

## The basics of logical vectors
I like to think of logical vectors (sometimes called *boolean* vectors) as the answer key to a TRUE/FALSE quiz. The vector `logic1` below is an example; notice it just contains a collection of five values, which can either be `TRUE` or `FALSE`: 
```{r echo =T}
logic1
```
In our case, we can think of `logic1` as the answer key to the following quiz:

```{r fig.align='center'}
kbl(df_numbers) %>% kable_styling()
```

Wait, can't we get a computer to do that?  Of course!

In the code below, we first create a vector of numbers (`quiz_numbers`) that we wish to test against the value of **10**.  Next, we compare `quiz_numbers` to the value of 10 using a `<` symbol. 

Try it out! Is `R` an A-student?
```{r quiz-compare-10, exercise = TRUE}
quiz_numbers<-c(1, 12, 4, 3, 15)

# now let's compare
quiz_numbers < 10
```

#### Exercise:
Consider the following True/False quiz.
```{r}
kbl(df_numbers2) %>% kable_styling()
```
As we did above, use `R` to get create the answer key in a logical vector. (*Hint:* you will need to create your own `quiz_numbers2` vector of values to compare against 15. We got you started)
```{r quiz-compare-15, exercise = TRUE}
# Write your comparision
quiz_numbers2 <- c( ... )
```

```{r quiz-compare-15-hint-1}
quiz_numbers2<- c(15, 19, 14, 3, 10, 18)
# Now write the comparison
```

```{r quiz-compare-15-hint-2}
quiz_numbers2<- c(15, 19, 14, 3, 10, 18)
# Now write the comparison
quiz_numbers2 > ...
```

```{r quiz-compare-15-solution}
quiz_numbers2<- c(15, 19, 14, 3, 10, 18)
# Now write the comparison
quiz_numbers2 > 15
```






## Other ways to compare numbers!
There are many ways to compare numbers in `R`, but these are the most common:
```{r}
kbl(
    data.frame(Symbol = c("<","<=",">",">=","==","!="),
               Meaning = c("strictly less than", "less than or equal", "strictly greater than", "greater than or equal", "equal to", "not equal to"))
) %>% kable_styling()
```

For fun, we wrote some comparisons below. Make sure the outputs make sense to you!

(You can run the lines below one at a time by highlighting a given line, and then hitting "Run Code.")
```{r comparisons, exercise=TRUE}
10 == 12
12 == 12

c(1, 2, 3, 4) <= 3
c(1, 2, 3, 4) < 3

10 !=12
12 !=12
```

### An application of numerical comparisons
Suppose we have a data frame with observations on 150 students; specifically we track their heights and IQs and record it in `students`.  We want to know what percentage of our sample is taller than 72 inches, the unit used in my data frame. How can logical vectors help with this task?

In `R`, logical values are also stored as numbers. Specifically, `TRUE` is treated as 1, and `FALSE` is treated as 0. To get our percentage, let's start by figuring out which students are taller than 72 inches.  Since there are 150 students, we will not want to do this by hand.  Instead, let's use a numerical comparison to generate a logical vector. Use the Code chunk below to 

1. get the `height` variable from the `students` data frame, and
2. compare that variable against 72 with the appropriate comparison symbol.

```{r student-height, exercise = TRUE}
# Place your code here
```

```{r student-height-hint-1}
students$height ...
```

```{r student-height-hint-2}
students$height > ...
```

```{r student-height-solution}
students$height > 72
```

How many of these are `TRUE`? Since each `TRUE` corresponds to a 1, and all the `FALSE` values correspond to zero, if we use the `sum()` command on this logical vector, it will naturally count all the `TRUE` responses!

```{r student-height-sum, exercise = TRUE}
sum( ...place logical here...)
```


```{r student-height-sum-solution}
sum(students$height > 72)
```

To convert this to a percentage, we simply divide by our sample size of 150. Write your final code to get the percentage of students above 72 inches in height.
```{r student-height-perc, exercise = TRUE}
# Place your code here.
```

```{r student-height-perc-solution}
sum(students$height > 72)/150
```

#### Quick practice:
What percentage of the students in the `students` data frame have an IQ less than or equal to 115?
```{r student-IQ1, exercise = TRUE}
# Place your code here.
```

```{r student-IQ1-solution}
sum(students$IQ <= 115)/150
```

What percentage of the students in the `students` data frame have an IQ exactly equal to 100? (Remember you need a "double equals" to compare equality!)
```{r student-IQ2, exercise = TRUE}
# Place your code here.
```

```{r student-IQ2-solution}
sum(students$IQ == 115)/150
```



## Text comparisons
We are also able to compare ***text*** in `R`.^[Text may also be referred to as "strings" or "characters". In `R`, these are often stored as **factors**, which are basically just character vectors with some added metadata.] However, text comparisons involve (mostly) different operators. In this section, we will discuss just a few of them: `==` and `!=`, the `%in%` operator, and the `grepl()` function.

We will do some initial explorations using a small version of the `iris` data set, which records flower measurements for three different species of iris. We call it `small_iris`. To make our output manageable, we have taken a subset of the original `iris` data frame that only includes three of each kind of flower, and we list the species and sepal length variables. When we are more comfortable, we will explore a larger data set. For now,

```{r echo = TRUE}
small_iris
```
Notice that the first three rows are `setosa`, the next three are `versicolor`, and the last three are `virginica`.


### Will the real `setosa` please stand up?
Suppose I want to find out how many of the flowers in `small_iris` are setosa irises. Sure, I could just view `small_iris` and count, but this doesn't scale very well. What if my data frame had 10,000 flowers?

As we saw in the last section, and easy way to count something is to `sum()` up a logical vector, where the entries we care about are labeled as `TRUE`. Since the `Species` variable is text, we can create such a logical vector by checking for *equality* with the desired "setosa" label.

Run the code below to see the logical vector. Then, use the `sum()` function to count the number of setosa irises in `small_iris`. Finally, write your own code to count the number of "virginica" irises.
```{r small-iris-ex1, exercise=TRUE,exercise.lines=4}
small_iris$Species == "setosa"
```
```{r small-iris-ex1-hint-1}
small_iris$Species == "setosa"
sum(small_iris$Species == "setosa")
```
```{r small-iris-ex1-hint-2}
small_iris$Species == "setosa"
sum(small_iris$Species == "setosa")
sum(small_iris$Species == "virginica")
```

The not equal comparison, `!=`, works on text as well.  Using a similar coding approach as the previous exercise, count how many flowers in `small_iris` are ***not equal*** to `setosa`.
```{r small-iris-ex2, exercise=TRUE,exercise.lines=4}
# Place your code here
```
```{r small-iris-ex2-hint-1}
#Complete the code below by putting something in the quotes!
small_iris$Species != "..."
# then sum this logical vector
```
```{r small-iris-ex2-solution}
sum(small_iris$Species!="setosa")
```
**Important Note:** If you get a count of zero and that is unexpected, ***check your spelling!***

### Checking a list with `%in%`
The `%in%` operator in `R` will check if text is in a provided list.  For example, can you explain what the code below does?
```{r echo = T}
small_iris$Species %in% c("virginica","versicolor")
```
Why are the first three entries `FALSE`? *In your own words*, explain what the code does!
```{r question-untidy-1}
question("Ready to see an explanation?",
answer("Yes.", correct = TRUE),
post_message = "The vector `small_iris$Species` contains text recording the species of each flower.  The `%in%` operator checks whether a given value from this vector is  ***in***  the list provided: `c(\"virginica\",\"versicolor\")`.  <br></br> Since the list provided contains only `virginica` and `versicolor` as options, the first three entries are False because they correspond to `setosa` flowers.  The last six entries are True because these are either `virginica` or `versicolor`."
)
```

#### Exercises with `tweets`
The `tweets` data frame contains several tweets pulled from a Kaggle data set (@tweet_data)^[We used the command line to just pull the first thousand tweets from this much larger data set.]
```{r}
kbl(tweets %>% head()) %>% kable_styling()

```




operators: `%in%` and basic `grepl()`


Examples

Examples with a data frame

Application of counting and finding percentages for categories

## Using `grepl()`

## Review exercises with new example

## Conclusions
Notes, comments, summaries.

Links to related exercises and resources.


## References
<div id="refs"></div>


***

## Example exercises

### Exercise 

*Here's a simple exercise with an empty code chunk provided for entering the answer.*

Write the R code required to add two plus two:

```{r two-plus-two, exercise=TRUE}

```

### Exercise with Code

*Here's an exercise with some prepopulated code as well as `exercise.lines = 5` to provide a bit more initial room to work.*

Now write a function that adds any two numbers and then call it:

```{r add-function, exercise=TRUE, exercise.lines = 5}
add <- function() {
  
}
```

## Topic 2

### Exercise with Hint

*Here's an exercise where the chunk is pre-evaluated via the `exercise.eval` option (so the user can see the default output we'd like them to customize). We also add a "hint" to the correct solution via the chunk immediate below labeled `print-limit-hint`.*

Modify the following code to limit the number of rows printed to 5:

```{r print-limit, exercise=TRUE, exercise.eval=TRUE}
mtcars
```

```{r print-limit-hint}
head(mtcars)
```


### Shiny Example
```{r, echo=FALSE}
sliderInput("bins", "Number of bins:", min = 1, max = 50, value = 30)
plotOutput("distPlot")
```

```{r, context="server"}
output$distPlot <- renderPlot({
  x <- faithful[, 2]  # Old Faithful Geyser data
  bins <- seq(min(x), max(x), length.out = input$bins + 1)
  hist(x, breaks = bins, col = 'darkgray', border = 'white')
})
```

### Quiz

*You can include any number of single or multiple choice questions as a quiz. Use the `question` function to define a question and the `quiz` function for grouping multiple questions together.*

Some questions to verify that you understand the purposes of various base and recommended R packages:

```{r quiz}
quiz(
  question("Which package contains functions for installing other R packages?",
    answer("base"),
    answer("tools"),
    answer("utils", correct = TRUE),
    answer("codetools")
  ),
  question("Which of the R packages listed below are used to create plots?",
    answer("lattice", correct = TRUE),
    answer("tools"),
    answer("stats"),
    answer("grid", correct = TRUE)
  )
)
```

